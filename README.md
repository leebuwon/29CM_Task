# 29CM_homework
---

### - 요구사항
- [x] 상품은 고유의 상품번호와 상품명, 판매가격, 재고수량 정보를 가지고 있습니다.
- [x] 한 번에 여러개의 상품을 같이 주문할 수 있어야 한다.
- [x] 상품번호, 주문수량은 반복적으로 입력 받을 수 있습니다.
- [x] 주문은 상품번호, 수량을 입력받습니다.
  - 세부 요구사항
  - [x] empty 입력(space + ENTER) 이 되었을 경우 해당 건에 대한 주문이 완료되고, 결제하는 것으로 판단합니다.
  - [x] 결지 시 재고 확인을 하여야 하며 재고가 부족할 경우 결제 시도하면 SoldOutException 이 발생되어야 합니다.
- [x] 주문 금액이 5만원 미만일 경우 배송료 2,500원이 추가되어야 합니다.
- [x] 주문이 완료되었을 경우 주문 내역과 주문 금액, 결제 금액 (배송비 포함) 을 화면에 display 합니다.
- [x] 'q' 또는 'quit'을 입력하면 프로그램이 종료되어야 합니다.
- [x] Test 에서는 반드시 multi thread 요청으로 SoldOutException 이 정상 동작하는지 단위테스트가 작성되어야 합니다.
- [x] 상품의 데이터는 하단에 주어지는 데이터를 사용해주세요.
  - 데이터를 불러오는 방식은 자유입니다.
  - 코드에 포함되어도 좋고, 파일을 불러도 되고, in memory db를 사용하셔도 됩니다.
  - 하지만 상품에 대한 상품번호, 상품명, 판매가격, 재고수량 데이터는 그대로 사용하셔야 합니다.
  - 상품 데이터 csv 파일을 같이 제공합니다.
     
---

### - 프로젝트 구조

프로젝트 구조에서 게층형 구조를 사용하기 보다는 도메인을 기준으로 패키지를 나눠서 구현하였습니다.

패키지는 크게 3개로 나눴습니다.

- app 패키지
  - application이 run 돼었을 경우 처음으로 CLI 화면에 보이는 클래스를 정리해놓은 디렉터리입니다.
  - `view`: app 디렉터리에 위치함으로써 리턴되는 결과들을 CLI 화면에 표시되는 공간을 정리해놨습니다.

- domain 패키지
  - 핵심 로직들이 저장되는 디렉터리입니다.
    - `controller`, `enttiy`, `service`, `repository`, `dto`, `exception` 이 저장되는 공간입니다.
      - `controller`: 클라이언트로부터 요청이 들어오면 비즈니스 로직을 호출하는 역할을 담당합니다.
      - `service`: 비즈니스 로직을 처리하는 역할을 담당합니다.
      - `repository`: entity(객체)에 접근하는 역할을 담당합니다.
      - `entity`: 데이터의 모델을 관리하는 역할을 담당합니다..
      - `dto`: 데이터를 전달하기 위한 단순한 객체를 담당하는 역할을 합니다.
      - `exception`: global exception을 상속받아 좀 더 구체적인 exception을 처리하는 역할을 담당합니다.
  - 도메인의 각각의 흐름을 간단하게 파악하기 위하여 Product, Order로 디렉터리를 나눴습니다.
  
- global
  - 패키지 이름에서 알 수 있듯이 전역적으로 관리되어야 하는 부분에 대해서 관리해주는 디렉터리입니다.
  - `exception`, `factory`, `storage`, `util` 로 나눠서 구현하였습니다.
    - `exception`: domain 패키지 내부에서 관리되는 excpetion의 조상이 될만한 exception을 저장해줍니다.
    - `factory`: 생성자를 외부에서 생성하여 주입해주기 위하여 관리해주는 디렉터리입니다.
    - `storage`: storage는 초기에 생성되어야 하는 상품에 대한 정보를 application이 실행될 때 만드는 역할을 합니다.
    - `util`: 입력(Console)받기 위한 클래스를 저장해주기 위하여 생성한 디렉터리 입니다.


---

### - 구현 방향

최대한 Spring 프레임워크의 MVC 패턴과 학습하였던 JPA를 기반으로 모방하여 설계하였습니다.
- **Model** : `Product`와 `Order` 엔티티를 표현하였으며 `OrderService`와 `ProductService`는 비즈니스 로직을 담당하였습니다. </br>
Service에서 모델에 대해서 찾을 경우 `findByProductId` 또는 `findAll()` 과 같이 리스트를 뽑아야할 경우에는 `Repository`에서 찾아서 반환하도록 하였습니다. 
- **View** : 사용자에게 정보를 시각적으로 전달하기 위하여 View는 따로 패키지로 빼서 관리하였습니다. </br>
각각 사용자의 상품번호와 수량 입력, 상품 목록, 주문 목록을 담당하며 사용자에게 보여주었습니다.
- **Controller** : 사용자의 입력을 받아와서 비즈니스 로직을 Service 계층으로 보내주는 역할을 하도록 구현하였습니다. </br>
또한 비즈니스 로직을 받아와서 사용자에게 보여지는 View로 보내주는 역할을 하였습니다.
- **SingletonFactory** : 스프링 IOC 컨테이너처럼 관리하고자 하였습니다. 생성자를 외부에서 생성하여 주입하는 형식으로 진행하고 싶어 `SingletonFactory`를 만들어 객체의 외부에서 생성하여 주입해주는 방식으로 하였습니다. </br>
싱글톤을 만드는 형식에서는 Bill Pugh가 고안한 방식으로 진행하였는데, 이유로는 멀티쓰레드 환경에서도 안전하며 Lazy loading도 가능하여 메모리 누수에도 효과적인 방법이라 가장 적합한 싱글톤 생성 기법이라고 셍각하였습니다.
